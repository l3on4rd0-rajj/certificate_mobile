import ipaddress
import subprocess
import platform

def ping_host(ip):
    """Executa ping em um único IP e retorna True se estiver ativo."""
    param = "-n" if platform.system().lower() == "windows" else "-c"
    try:
        result = subprocess.run(["ping", param, "1", str(ip)],
                                stdout=subprocess.DEVNULL,
                                stderr=subprocess.DEVNULL)
        return result.returncode == 0
    except Exception as e:
        print(f"Erro ao pingar {ip}: {e}")
        return False

def scan_subnet(rede_cidr):
    """Faz ping em todos os IPs de uma rede CIDR."""
    try:
        rede = ipaddress.ip_network(rede_cidr, strict=False)
    except ValueError as e:
        print(f"Erro: {e}")
        return

    print(f"Escaneando rede: {rede_cidr}")
    ativos = []

    for ip in rede.hosts():
        print(f"Testando {ip}...", end="\r")
        if ping_host(ip):
            print(f"[+] {ip} ativo")
            ativos.append(str(ip))

    with open("ativos.txt", "w") as f:
        f.write("\n".join(ativos))

    print(f"\nVarredura concluída. {len(ativos)} IP(s) ativo(s) encontrados.")
    print("Resultado salvo em 'ativos.txt'.")

if __name__ == "__main__":
    rede_input = input("Digite o IP com CIDR (ex: 192.168.1.0/24): ")
    scan_subnet(rede_input)
